{# reports/report_detail.html #}
{% extends 'base.html' %}

{% block title %}Detail reportu: {{ object.title }}{% endblock %}

{% block content %}
  <h1>{{ object.title }}</h1>
  <p>Autor: {{ object.author.username }}</p>
  <p>Rok: {{ object.year }}</p>

  {# Pro kontrolu - zkontroluj, zda se report načítá #}
  <p>Report ID: {{ object.pk }}</p>

  {% if user.is_authenticated %}
    <a href="{% url 'reports:report_edit' object.pk %}">Editovat report</a>
  {% endif %}

  {% for section in object.sections.all %}
    <h2>{{ section.title }}</h2>
    <p>Počet elementů: {{ section.content_elements.count }}</p>

    {# Formulář pro přidání odstavce #}
    <form method="post">
      {% csrf_token %}
      <input type="hidden" name="section_id" value="{{ section.id }}">
      <button type="submit" name="add_paragraph">Přidat odstavec</button>
    </form>

    {% for element in section.content_elements.all %}
      <div class="content-element" data-element-id="{{ element.id }}" data-element-type="{{ element.get_class_name }}">
        <p>Typ: {{ element.get_class_name }} | Pořadí: {{ element.order }} | Element ID: {{ element.id }}</p>
        <div class="content-element-body">
          <p>Text: {{ element.text }}</p>
        </div>
  
        {% if element.get_class_name == 'Paragraph' %}
        
        <div class="content-element-footer">
          <div class="element-info">
            <p>Autor: {{ element.author.username }}</p>|
            <p>Vytvořeno: {{ element.created_at }}</p>|
            <p>Poslední úprava: {{ element.updated_at }}</p>
          </div>
        
          <div class="element-controls">
            <a href="{% url 'reports:paragraph_edit' element.pk %}">Editovat odstavec</a>
            <form method="post" style="display:inline;">
              {% csrf_token %}
              <input type="hidden" name="paragraph_id" value="{{ element.id }}">
              <button type="submit" name="move_paragraph_up" class="arrow-button" {% if element.order == 1 %}disabled{% endif %}>▲</button>
            </form>
        
            <form method="post" style="display:inline;">
              {% csrf_token %}
              <input type="hidden" name="paragraph_id" value="{{ element.id }}">
              <button type="submit" name="move_paragraph_down" class="arrow-button">▼</button>
            </form>
          </div>
        </div>

        {% elif element.get_class_name == 'Chart' %}
          <p>Graf: {{ element.title }} (zatím bez obsahu)</p>
        {% elif element.get_class_name == 'Table' %}
          <p>Tabulka: {{ element.title }} (zatím bez obsahu)</p>
        {% endif %}
      </div>
    {% endfor %}
  {% endfor %}
{% endblock %}