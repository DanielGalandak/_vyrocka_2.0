{# reports/report_detail.html #}
{% extends 'base.html' %}

{% block title %}Detail reportu: {{ object.title }}{% endblock %}

{% block content %}
  <h1>{{ object.title }}</h1>
  <p>Autor: {{ object.author.username }}</p>
  <p>Rok: {{ object.year }}</p>

  {% if user.is_authenticated and user == object.author or user.profile.is_admin or user.profile.is_editor %}
    <a href="{% url 'reports:report_edit' object.pk %}">Editovat report</a>
  {% endif %}

  {% for section in object.sections.all %}
    <h2>{{ section.title }}</h2>

    {% for element in section.content_elements.all %}
      {% if element.get_concrete_instance.text %}
        <p>{{ element.get_concrete_instance.text }}</p>
      {% elif element.get_concrete_instance.title %}
        <p>Graf: {{ element.get_concrete_instance.title }} (zatím bez obsahu)</p>
      {% elif element.get_concrete_instance.data %}
        <p>Tabulka: {{ element.get_concrete_instance.title }} (zatím bez obsahu)</p>
      {% endif %}
    {% endfor %}
  {% endfor %}

  {% if user.is_authenticated and (user == object.author or user.profile.is_editor or user.profile.is_admin) %}
    <h2>Přidat odstavec</h2>
    <form method="post">
        {% csrf_token %}
        {{ paragraph_form.as_p }}
        <button type="submit" name="add_paragraph">Uložit</button>
    </form>
    
    <form method="post">
        {% csrf_token %}
        {{ chart_form.as_p }}
        <button type="submit" name="add_chart">Uložit</button>
    </form>
    
    <form method="post">
        {% csrf_token %}
        {{ table_form.as_p }}
        <button type="submit" name="add_table">Uložit</button>
    </form>
  {% endif %}
{% endblock %}